<!DOCTYPE html>

<html>
<head>
  <title>window.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>

      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">


                <a class="source" href="deferred.js.html">
                  deferred.js
                </a>


                <a class="source" href="indexer.js.html">
                  indexer.js
                </a>


                <a class="source" href="procession.js.html">
                  procession.js
                </a>


                <a class="source" href="pumper.js.html">
                  pumper.js
                </a>


                <a class="source" href="shifter.js.html">
                  shifter.js
                </a>


                <a class="source" href="splitter.js.html">
                  splitter.js
                </a>


                <a class="source" href="throttle.js.html">
                  throttle.js
                </a>


                <a class="source" href="transformer.js.html">
                  transformer.js
                </a>


                <a class="source" href="window.js.html">
                  window.js
                </a>

            </div>
          </div>
        </li>
      </ul>

    <ul class="sections">

          <li id="title">
              <div class="annotation">
                  <h1>window.js</h1>
              </div>
          </li>



        <li id="section-1">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Node.js API.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>)
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>)

<span class="hljs-keyword">var</span> Pumper = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./pumper'</span>)
<span class="hljs-keyword">var</span> Procession = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./procession'</span>)
<span class="hljs-keyword">var</span> Deferred = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./deferred'</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Window</span> (<span class="hljs-params"></span>) </span>{
    Procession.call(<span class="hljs-keyword">this</span>)
    <span class="hljs-keyword">this</span>.trailer = <span class="hljs-keyword">this</span>.shifter(<span class="hljs-keyword">this</span>, <span class="hljs-string">'_shift'</span>)
    <span class="hljs-keyword">this</span>._header = <span class="hljs-keyword">this</span>.shifter()
    <span class="hljs-keyword">this</span>._undecorated = []
    <span class="hljs-keyword">this</span>._listeners = []
</pre></div></div>

        </li>


        <li id="section-2">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>We’re not shifting, we’re pushing so it has to wait, because it is
synchronous and no one else will have an opportunity to push.</p>

            </div>

            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._header.pump(<span class="hljs-keyword">this</span>, <span class="hljs-string">'_push'</span>)
}
util.inherits(Window, Procession)

</pre></div></div>

        </li>


        <li id="section-3">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Add a listener that can track values as they are enqueued and dequeued. The
listener’s push and shift methods  will only be invoked for values enqueued
after it is added to to the procession.</p>
<hr>

            </div>

        </li>


        <li id="section-4">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>

            </div>

        </li>


        <li id="section-5">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We decorate the listener with a deferred decorator. We keep a parallel arrays
of undecorated listeners do we can find its array index if we’re asked to
remove it before it undecorates itself.</p>

            </div>

            <div class="content"><div class='highlight'><pre>Window.prototype.addListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">listener</span>) </span>{
    <span class="hljs-keyword">this</span>._undecorated.push(listener)
    <span class="hljs-keyword">this</span>._listeners.push(<span class="hljs-keyword">new</span> Deferred(<span class="hljs-keyword">this</span>._listeners, listener))
}

</pre></div></div>

        </li>


        <li id="section-6">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Remove a listener.</p>
<hr>

            </div>

        </li>


        <li id="section-7">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>

            </div>

            <div class="content"><div class='highlight'><pre>Window.prototype.removeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">listener</span>) </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>._undecorated.indexOf(<span class="hljs-keyword">this</span>)
    <span class="hljs-keyword">this</span>._undecorated.splice(index, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">this</span>._listeners.splice(index, <span class="hljs-number">1</span>)
}

Window.prototype._push = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
        assert(<span class="hljs-keyword">this</span>._header.node == <span class="hljs-keyword">this</span>.head)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, I = <span class="hljs-keyword">this</span>._listeners.length; i &lt; I; i++) {
            <span class="hljs-keyword">this</span>._listeners[i].pushed(<span class="hljs-keyword">this</span>._header.node)
        }
    }
}

Window.prototype._shift = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">if</span> (node.body != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, I = <span class="hljs-keyword">this</span>._listeners.length; i &lt; I; i++) {
            <span class="hljs-keyword">this</span>._listeners[i].shifted(node)
        }
    }
}

<span class="hljs-built_in">module</span>.exports = Window

</pre></div></div>

        </li>

    </ul>
  </div>
</body>
</html>
